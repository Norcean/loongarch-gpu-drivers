# Maintainer: zint <zint@tuta.io>
# Contributor: zint <zint@tuta.io>

pkgname=xf86-video-loonggpu
pkgver=1.0.2
_pkgver=${pkgver}-lnd25.1~rc1.7
pkgrel=3
pkgdesc="LOONGGPU binary Xorg driver
 loonggpu is an Xorg video driver for the kernel driver which name is the
 value of \"MatchDriver\" in 20-loonggpu.conf. Note that 3D acceleration is
 available through enable the EXA layer. If the fake EXA accerelation is
 not enabled, then this driver will fallback to shadowfb. This driver
 supports TrueColor visuals at framebuffer depths of 15, 16, 24, and 30.
 This package is build from the X.org xf86-video-loonggpu driver module."
license=()
arch=(loong64)
makedepends=(
	binutils
	libarchive
	)
depends=(
	libedit
	libldrm
	loonggl
	)
options=(!debug !strip)
source=(
	"https://pkg.loongnix.cn/loongnix/25/pool/non-free/l/loonggpu-graphics-drivers/xserver-xorg-video-loonggpu_${_pkgver}_${arch}.deb"
	"loonggpu_driver.conf"
)
b2sums=('ce459b8834752ab6cb4783da58b36df68198d6ebfa9ef60caf850321f63901e62cd235b7f3f78925ea1b6f90099561b4ae872e7bb01b55adabb66dd906eff157'
        '4187dac562b863d7675e1c79d9b887cbe1935e287e670a6c6e901752861e8e62e47463abe64e75b7da3421ed71f73ad3eff06bb63f5c04a7e3865e4e564ff9d3')

prepare(){
	bsdtar -xf "${srcdir}/data."*
}
package(){
	mkdir -p "${pkgdir}/usr"
	mkdir -p "${pkgdir}/etc/loonggpu"

	install -Dm644 "${srcdir}/loonggpu_driver.conf" "${pkgdir}/etc/loonggpu/loonggpu_driver.conf"
	install -Dm755 "${srcdir}/usr/lib/xorg/modules/drivers/loonggpu_drv.so" "${pkgdir}/usr/lib/xorg/modules/drivers/loonggpu_drv.so"

	pushd "${pkgdir}/usr/lib"
	ln -s libedit.so libedit.so.2
	popd

	pushd "${pkgdir}/usr/lib/xorg/modules"
	ln -s ../../dri/gsgpu_dri.so
	popd

	cp -r "${srcdir}/usr/share" "${pkgdir}/usr/"
}
