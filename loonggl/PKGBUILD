# Maintainer: zint <zint@tuta.io>
# Contributor: zint <zint@tuta.io>

pkgname=loonggl
pkgver=1.0.2
_pkgver=${pkgver}-lnd25.1~rc1.7
pkgrel=3
pkgdesc="LOONGGPU binary OpenGL|ES|EGL|GLX library
 This package contains the development environment required for compiling
 programs against EGL native platform graphics interface library.
 EGL provides a platform-agnostic mechanism for creating rendering surfaces
 for use with other graphics libraries, such as OpenGL|ES|EGL|GLX."
license=()
arch=(loong64)
makedepends=(
	binutils
	libarchive
)
depends=(
	linux-firmware-loongson
	libldrm
	libloong-gpucomp
	libglvnd
	)
options=(!debug !strip)
source=(
	"https://pkg.loongnix.cn/loongnix/25/pool/non-free/l/loonggpu-graphics-drivers/loonggl_${_pkgver}_${arch}.deb"
)
b2sums=('e87ff62fd7b6c8b704c05c1d8adfb5cec5e5027e341f8450123687c49c43333cbb44280c4426a237d8c3fe0f423ba694349be8dea96b4eccf3699aa1e8f20152')

prepare(){
	bsdtar -xf "${srcdir}/data."*
}
package(){

	mkdir -p "${pkgdir}/usr/"
	cp -r "${srcdir}/usr/lib/loongarch64-linux-gnu/" "${pkgdir}/usr/lib/"

	pushd "${pkgdir}/usr/lib"
	ln -s loonggpu/libglapidispatch.so.0
	popd

	install -Dm644 "${srcdir}/usr/share/glvnd/egl_vendor.d/40_gsgpu.json" "${pkgdir}/usr/share/glvnd/egl_vendor.d/40_gsgpu.json"
	install -Dm644 "${srcdir}/usr/share/glvnd/egl_vendor.d/40_loonggpu.json" "${pkgdir}/usr/share/glvnd/egl_vendor.d/40_loonggpu.json"

	install -Dm644 ${srcdir}/usr/share/doc/loonggl/copyright ${pkgdir}/usr/share/doc/loonggl/copyright
}
